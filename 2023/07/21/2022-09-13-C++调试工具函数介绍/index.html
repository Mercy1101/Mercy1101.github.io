<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mercy1101.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="我们假设人是会出错的，所以我们需要调试找寻 BUG 我们假设框架和流程设计基本正确，所以找寻问题的时间远大于改正问题的时间 我们假设人是懒惰的，所以总是倾向于写更少的代码  PPT 调试日志打印类转换字符串 to_string应用场景: 想要把某种类型转换为字符串 简单的转换: 1printf(&quot;%d&quot;, i);  实际中可能用到的转换: 12345678910printf(">
<meta property="og:type" content="article">
<meta property="og:title" content="C++调试工具函数介绍">
<meta property="og:url" content="https://mercy1101.github.io/2023/07/21/2022-09-13-C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/index.html">
<meta property="og:site_name" content="Jiancong Li&#39;s Blog">
<meta property="og:description" content="我们假设人是会出错的，所以我们需要调试找寻 BUG 我们假设框架和流程设计基本正确，所以找寻问题的时间远大于改正问题的时间 我们假设人是懒惰的，所以总是倾向于写更少的代码  PPT 调试日志打印类转换字符串 to_string应用场景: 想要把某种类型转换为字符串 简单的转换: 1printf(&quot;%d&quot;, i);  实际中可能用到的转换: 12345678910printf(">
<meta property="og:locale">
<meta property="og:image" content="https://mercy1101.github.io/resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/Benchmark_gos_log.png">
<meta property="og:image" content="https://mercy1101.github.io/resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/Benchmark_log_stream.png">
<meta property="og:image" content="https://mercy1101.github.io/resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/log_stream.png">
<meta property="article:published_time" content="2023-07-21T05:28:45.226Z">
<meta property="article:modified_time" content="2023-10-28T06:29:44.899Z">
<meta property="article:author" content="Jiancong Li">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mercy1101.github.io/resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/Benchmark_gos_log.png">

<link rel="canonical" href="https://mercy1101.github.io/2023/07/21/2022-09-13-C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'cn'
  };
</script>

  <title>C++调试工具函数介绍 | Jiancong Li's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jiancong Li's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://mercy1101.github.io/2023/07/21/2022-09-13-C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jiancong Li">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiancong Li's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C++调试工具函数介绍
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-21 13:28:45" itemprop="dateCreated datePublished" datetime="2023-07-21T13:28:45+08:00">2023-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-10-28 14:29:44" itemprop="dateModified" datetime="2023-10-28T14:29:44+08:00">2023-10-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ul>
<li>我们假设人是会出错的，所以我们需要调试找寻 BUG</li>
<li>我们假设框架和流程设计基本正确，所以<strong>找寻问题的时间</strong>远大于<strong>改正问题的时间</strong></li>
<li>我们假设人是懒惰的，所以总是倾向于写更少的代码</li>
</ul>
<p><a href="../resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/2022_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA.pptx">PPT</a></p>
<h2 id="调试日志打印类"><a href="#调试日志打印类" class="headerlink" title="调试日志打印类"></a>调试日志打印类</h2><h3 id="转换字符串-to-string"><a href="#转换字符串-to-string" class="headerlink" title="转换字符串 to_string"></a>转换字符串 to_string</h3><p>应用场景: 想要把某种类型转换为字符串</p>
<p>简单的转换:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, i);</span><br></pre></td></tr></table></figure>

<p>实际中可能用到的转换:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Integers\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Decimal:\t%i %d %.6i %i %.0i %+i %i\n&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">-4</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Hexadecimal:\t%x %x %X %#x\n&quot;</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">6</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Octal:\t%o %#o %#o\n&quot;</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Floating point\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Rounding:\t%f %.0f %.32f\n&quot;</span>, <span class="number">1.5</span>, <span class="number">1.5</span>, <span class="number">1.3</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Padding:\t%05.2f %.2f %5.2f\n&quot;</span>, <span class="number">1.5</span>, <span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Scientific:\t%E %e\n&quot;</span>, <span class="number">1.5</span>, <span class="number">1.5</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Hexadecimal:\t%a %A\n&quot;</span>, <span class="number">1.5</span>, <span class="number">1.5</span>);</span><br></pre></td></tr></table></figure>

<p>因为自己使用占用符可能会出现使用错误(VS 编译检测不出来, g++ 有部分警告), 为了正确和格式的统一现使用统一函数封装</p>
<p>基本类型的重载:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">int</span> i)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">unsigned</span> i)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> i)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> x)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">long</span> i)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">short</span> x)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> x)</span></span>;</span><br></pre></td></tr></table></figure>

<p>特殊类型的重载:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 保留两位小数: 输出类似 1.12</span></span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">double</span> d)</span></span>;</span><br><span class="line"><span class="comment">/// 返回字符串: &quot;true&quot; 或 &quot;false&quot;</span></span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">bool</span> x)</span></span>;</span><br><span class="line"><span class="comment">/// 重载指针, 输出类似 0x123</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> std::string <span class="title">to_string</span><span class="params">(T* <span class="type">const</span> x)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用-string-stream-拼接字符串"><a href="#使用-string-stream-拼接字符串" class="headerlink" title="使用 string_stream 拼接字符串"></a>使用 <code>string_stream</code> 拼接字符串</h3><p>场景: 拼接字符串</p>
<h4 id="C-是如何拼接字符串的"><a href="#C-是如何拼接字符串的" class="headerlink" title="C 是如何拼接字符串的?"></a>C 是如何拼接字符串的?</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> ac[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">strcat</span>(ac, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="built_in">strcat</span>(ac, <span class="string">&quot;World&quot;</span>);</span><br><span class="line"><span class="built_in">strcat</span>(ac, gos::<span class="built_in">to_string</span>(<span class="number">123</span>).<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure>

<h4 id="C-是如何拼接字符串的-1"><a href="#C-是如何拼接字符串的-1" class="headerlink" title="C++ 是如何拼接字符串的?"></a>C++ 是如何拼接字符串的?</h4><p>std::string 怎么实现拼接函数的</p>
<p>&#x2F;&#x2F;&#x2F; 编译错误</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string str;</span><br><span class="line">str = <span class="string">&quot;123&quot;</span> + <span class="string">&quot;456&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F;&#x2F; 编译成功</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::string str;</span><br><span class="line"><span class="function">std::string <span class="title">strTemp</span><span class="params">(<span class="string">&quot;456&quot;</span>)</span></span>;</span><br><span class="line">str = <span class="string">&quot;123&quot;</span> + strTemp;</span><br></pre></td></tr></table></figure>

<p>重载 “+” 操作符，实现字符串拼接</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::string <span class="keyword">operator</span>+(<span class="type">const</span> std::string&amp; strLeft, <span class="type">const</span> std::string&amp; strRight);</span><br></pre></td></tr></table></figure>

<p>调用过程解析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&quot;123&quot;</span> + strTemp;</span><br><span class="line">&lt;=&gt;</span><br><span class="line">str = <span class="keyword">operator</span>+(<span class="string">&quot;123&quot;</span>, strTemp);</span><br><span class="line">&lt;=&gt;</span><br><span class="line">str = <span class="keyword">operator</span>+(std::<span class="built_in">string</span>(<span class="string">&quot;123&quot;</span>), strTemp);</span><br></pre></td></tr></table></figure>

<p>最后的拼接方式为:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::string str;</span><br><span class="line"><span class="function">std::string <span class="title">strTemp</span><span class="params">(<span class="string">&quot;World&quot;</span>)</span></span>;</span><br><span class="line">str = <span class="string">&quot;Hello&quot;</span> + strTemp + gos::<span class="built_in">to_string</span>(i);</span><br><span class="line">&lt;=&gt;</span><br><span class="line">str = (<span class="string">&quot;Hello&quot;</span> + strTemp) + gos::<span class="built_in">to_string</span>(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>

<h4 id="string-stream-是如何拼接字符串的"><a href="#string-stream-是如何拼接字符串的" class="headerlink" title="string_stream 是如何拼接字符串的?"></a><code>string_stream</code> 是如何拼接字符串的?</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gos::string_stream stream;</span><br><span class="line">stream &lt;&lt; <span class="string">&quot;Hello&quot;</span> &lt;&lt; <span class="string">&quot;World&quot;</span> &lt;&lt; <span class="number">123</span>;</span><br></pre></td></tr></table></figure>

<p>那么 gos::string_stream 是如何实现的?</p>
<p>查看对象原型:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">string_stream</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">int</span> i)</span><br><span class="line">    &#123;</span><br><span class="line">        m_str += i;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string m_str;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>解析调用过程:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gos::string_stream stream;</span><br><span class="line">stream &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">&lt;=&gt;</span><br><span class="line">stream.<span class="keyword">operator</span>&lt;&lt;(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="string-stream-对其他复杂类型的处理"><a href="#string-stream-对其他复杂类型的处理" class="headerlink" title="string_stream 对其他复杂类型的处理"></a><code>string_stream</code> 对其他复杂类型的处理</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 打印 socket 地址</span></span><br><span class="line">string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> SOCKADDR_IN&amp; addr_in);</span><br><span class="line"><span class="comment">/// 打印 PID_T</span></span><br><span class="line">string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> PID_T&amp; stPID);</span><br><span class="line"><span class="comment">/// 打印 vector</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> std::vector&lt;T&gt;&amp; vec);</span><br><span class="line"><span class="comment">/// 打印 二进制数据</span></span><br><span class="line">string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;&amp; vec);</span><br><span class="line"><span class="comment">/// 打印 map</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Key, <span class="keyword">typename</span> Value&gt;</span><br><span class="line">string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> std::map&lt;Key, Value&gt;&amp; map);</span><br></pre></td></tr></table></figure>

<h4 id="string-stream-如何转换为-std-string"><a href="#string-stream-如何转换为-std-string" class="headerlink" title="string_stream 如何转换为 std::string"></a><code>string_stream</code> 如何转换为 std::string</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">string_stream</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">str</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="使用-string-stream-打印结构体"><a href="#使用-string-stream-打印结构体" class="headerlink" title="使用 string_stream 打印结构体"></a>使用 <code>string_stream</code> 打印结构体</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">STRUCT_T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">double</span> d;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以这样打印:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STRUCT_T st;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d, %f&quot;</span>, st.i, st.d);</span><br></pre></td></tr></table></figure>

<p><code>gos::string_stream</code> 如何打印:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gos::string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(gos::string_stream&amp; out, <span class="type">const</span> STRUCT_T&amp; st)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; st.i &lt;&lt; st.d;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gos::string_stream stream;</span><br><span class="line">stream &lt;&lt; st;</span><br></pre></td></tr></table></figure>

<p>考虑如下情况:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">STRUCT_T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">double</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 该函数是否可行?</span></span><br><span class="line">gos::string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(gos::string_stream&amp; out, <span class="type">const</span> STRUCT_T&amp; st)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; st.i &lt;&lt; st.d;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">STRUCT_T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">double</span> d;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> gos::string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(gos::string_stream&amp; out, <span class="type">const</span> STRUCT_T&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        out &lt;&lt; st.i &lt;&lt; st.d;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="string-stream-与-GosLog-的适配"><a href="#string-stream-与-GosLog-的适配" class="headerlink" title="string_stream 与 GosLog 的适配"></a>string_stream 与 GosLog 的适配</h4><h5 id="DBG"><a href="#DBG" class="headerlink" title="DBG"></a><code>DBG</code></h5><p>查看函数定义:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">std::string <span class="title">format_dbg_string</span><span class="params">(<span class="type">const</span> T&amp; x, <span class="type">const</span> std::string&amp; strName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gos::string_stream stream;</span><br><span class="line">    stream &lt;&lt; strName &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> stream.<span class="built_in">str</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span>* szMsgName = <span class="string">&quot;MsgName&quot;</span>;</span><br><span class="line"><span class="built_in">GosLog</span>(LOG_INFO, <span class="string">&quot;szMsgName: %s&quot;</span>, gos::format_dbg_string(szMsgName, <span class="string">&quot;szMsgName&quot;</span>).<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure>

<p>使用辅助宏定义:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DBG(x) gos::format_dbg_string(x, std::string(#x)).c_str()</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">GosLog</span>(LOG_INFO, <span class="string">&quot;szMsgName: %s&quot;</span>, gos::format_dbg_string(szMsgName, <span class="string">&quot;szMsgName&quot;</span>).<span class="built_in">c_str</span>());</span><br><span class="line">&lt;=&gt;</span><br><span class="line"><span class="built_in">GosLog</span>(LOG_INFO, <span class="string">&quot;%s&quot;</span>, <span class="built_in">DBG</span>(szMsgName));</span><br></pre></td></tr></table></figure>

<h5 id="DBG-给日志带来的改变"><a href="#DBG-给日志带来的改变" class="headerlink" title="DBG 给日志带来的改变"></a><code>DBG</code> 给日志带来的改变</h5><ol>
<li>省去了输入变量名称的过程, 见下面示例:</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GosLog</span>(LOG_ERROR, <span class="string">&quot;CRC error! %s, %s, %s, %s &quot;</span>, <span class="built_in">DBG</span>(ucLocalCRC16_H), <span class="built_in">DBG</span>(ucLocalCRC16_L), <span class="built_in">DBG</span>(ucCRC16_H), <span class="built_in">DBG</span>(ucCRC16_L);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>可以打印任意类型，使用单一占位符<code>%s</code>规避了占位符错误导致的崩溃，见如下示例:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">123</span>;</span><br><span class="line"><span class="type">double</span> d = <span class="number">1.123456</span>;</span><br><span class="line"><span class="type">char</span>* szMsgName = <span class="string">&quot;AppGetCfgReq&quot;</span>;</span><br><span class="line"><span class="type">bool</span> b = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">GosLog</span>(LOG_ERROR, <span class="string">&quot;%s %s %s %s&quot;</span>, <span class="built_in">DBG</span>(i), <span class="built_in">DBG</span>(d), <span class="built_in">DBG</span>(szMsgName), <span class="built_in">DBG</span>(b));</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 输出</span></span><br><span class="line"><span class="number">2022</span><span class="number">-10</span><span class="number">-16</span> <span class="number">0</span>8:<span class="number">0</span>8:<span class="number">43.908</span> [ERROR] [dis] :<span class="built_in">i</span>(<span class="number">123</span>)  <span class="built_in">d</span>(<span class="number">1.12</span>) <span class="built_in">szMsgName</span>(AppGetCfgReq), <span class="built_in">b</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以打印结构体</p>
</li>
</ol>
   <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">STRUCT_T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">double</span> d;</span><br><span class="line">    <span class="keyword">friend</span> gos::string_stream&amp; <span class="keyword">operator</span>&lt;&lt;(gos::string_stream&amp; out, <span class="type">const</span> STRUCT_T&amp; st)</span><br><span class="line">    &#123;</span><br><span class="line">        out &lt;&lt; <span class="string">&quot;STRUCT_T: &quot;</span> &lt;&lt; <span class="built_in">DBG</span>(&amp;st);</span><br><span class="line">    	out &lt;&lt; <span class="built_in">DBG</span>(st.i);</span><br><span class="line">        out &lt;&lt; <span class="built_in">DBG</span>(st.d);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">GosLog</span>(LOG_ERROR,<span class="string">&quot;%s&quot;</span>, <span class="built_in">DBG</span>(st));</span><br><span class="line"><span class="comment">/// 输出</span></span><br><span class="line"><span class="number">2022</span><span class="number">-10</span><span class="number">-16</span> <span class="number">0</span>8:<span class="number">0</span>8:<span class="number">43.908</span> [ERROR] [dis] :STRUCT_T: <span class="number">0x2389472</span> <span class="built_in">i</span>(<span class="number">123</span>)<span class="built_in">d</span>(<span class="number">1.12</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="日志流-log-stream"><a href="#日志流-log-stream" class="headerlink" title="日志流 log_stream"></a>日志流 <code>log_stream</code></h3><p>使用 <code>string_stream</code> 实现字符串拼接， 使用析构函数调用打印日志函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">log_stream</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    log_stream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="type">const</span> T&amp; data)</span><br><span class="line">    &#123;</span><br><span class="line">        m_stream &lt;&lt; data;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">log_stream</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">GosLog</span>(LOG_INFO, <span class="string">&quot;%s&quot;</span>, m_stream.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    gos::string_stream m_stream;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 定义辅助宏</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG gos::log_stream() stream</span></span><br><span class="line"></span><br><span class="line">LOG &lt;&lt; <span class="string">&quot;Hello&quot;</span> &lt;&lt; <span class="string">&quot;World&quot;</span>;</span><br></pre></td></tr></table></figure>


<h3 id="异步日志-log-sync"><a href="#异步日志-log-sync" class="headerlink" title="异步日志 log_sync"></a>异步日志 <code>log_sync</code></h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>生产者-消费者模型</p>
<p><a href="../resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97%E5%8E%9F%E7%90%86.png">异步日志原理</a></p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">log_sync</span> : <span class="keyword">public</span> GThread</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; level, <span class="type">const</span> std::string&amp; strLog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        queue.<span class="built_in">push</span>(level, strLog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> GOS_THREAD_RET <span class="title">ThreadEntry</span><span class="params">(<span class="type">void</span>* pPara)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::string strLog = queue.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="comment">/// 写入文件</span></span><br><span class="line">            <span class="built_in">log_to_file</span>(<span class="string">&quot;%s&quot;</span>, strLog.<span class="built_in">c_str</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="性能比较"><a href="#性能比较" class="headerlink" title="性能比较"></a>性能比较</h4><p>测试环境:</p>
<ul>
<li><p>CPU AMD Ryzen 7 PRO 4750U(8核16线程)</p>
</li>
<li><p>16G</p>
</li>
<li><p>固态硬盘</p>
</li>
<li><p>Win11 专业版 22H2</p>
</li>
<li><p>VS2022 C++20 Release</p>
</li>
<li><p>测试框架为 <a target="_blank" rel="noopener" href="https://github.com/google/benchmark">google&#x2F;benchmark</a></p>
</li>
</ul>
<p>在短字符串和4K长度字符串，分别在 1线程、2线程、4线程和8线程下运行结果如下:</p>
<p><code>GosLog</code>:<br><img src="/../resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/Benchmark_gos_log.png" alt="gos_log"></p>
<p><code>log_stream</code>:<br><img src="/../resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/Benchmark_log_stream.png" alt="log_stream"></p>
<p>性能比较:</p>
<table>
<thead>
<tr>
<th align="center">测试用例</th>
<th align="center">GosLog</th>
<th align="center">log_sync</th>
<th align="center">GosLog&#x2F;log_sync</th>
</tr>
</thead>
<tbody><tr>
<td align="center">短字符串 、 1线程</td>
<td align="center">93.3478k&#x2F;s</td>
<td align="center">20.9662k&#x2F;s</td>
<td align="center">445%</td>
</tr>
<tr>
<td align="center">短字符串 、 2线程</td>
<td align="center">99.8429k&#x2F;s</td>
<td align="center">20.7688k&#x2F;s</td>
<td align="center">408%</td>
</tr>
<tr>
<td align="center">短字符串 、 4线程</td>
<td align="center">47.5319k&#x2F;s</td>
<td align="center">24.1499k&#x2F;s</td>
<td align="center">196%</td>
</tr>
<tr>
<td align="center">短字符串 、 8线程</td>
<td align="center">44.5061k&#x2F;s</td>
<td align="center">23.4319k&#x2F;s</td>
<td align="center">190%</td>
</tr>
<tr>
<td align="center">4K 字符串 、 1线程</td>
<td align="center">35.7577k&#x2F;s</td>
<td align="center">17.9889k&#x2F;s</td>
<td align="center">199%</td>
</tr>
<tr>
<td align="center">4K 字符串 、 2线程</td>
<td align="center">29.3773k&#x2F;s</td>
<td align="center">19.0816k&#x2F;s</td>
<td align="center">153%</td>
</tr>
<tr>
<td align="center">4K 字符串 、 4线程</td>
<td align="center">29.6178k&#x2F;s</td>
<td align="center">17.3948k&#x2F;s</td>
<td align="center">170%</td>
</tr>
<tr>
<td align="center">4K 字符串 、 8线程</td>
<td align="center">32.3738k&#x2F;s</td>
<td align="center">18.317k&#x2F;s</td>
<td align="center">176%</td>
</tr>
</tbody></table>
<p><code>GosLog</code> 在上面测试速度全面领先与 <code>log_steam</code>, 性能高出 <code>1.5</code> 到 <code>4.4</code> 倍。</p>
<p>备注:</p>
<p><img src="/../resource/2021_09_13_C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D_%E6%9D%8E%E5%BB%BA%E8%81%AA/log_stream.png" alt="图片"></p>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p>优点:</p>
<ul>
<li>可以打印大于 4k 的字符串</li>
<li>多线程调用不会串行等待</li>
<li>不会输出到命令行，可以用作详细打印</li>
<li>可以利用 <code>operator&lt;&lt;</code> 打印， 便于快速编写代码</li>
</ul>
<p>缺点:</p>
<ul>
<li>性能远不如 <code>GosLog</code></li>
<li>调用打印和写入文件之间有延迟，在此期间崩溃会导致部分异步日志来不及写入文件</li>
<li>生产者速度过快会导致丢弃部分异步日志</li>
</ul>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>详细打印(如结构体内的成员信息), 不会导致 cmd 里刷新过快</li>
<li>所有收发信令打印</li>
<li>数据库数据打印(从数据库中读取到内存时)</li>
<li>渲染视频帧线程打印(不会阻塞当前线程)</li>
</ul>
<h3 id="日志宏"><a href="#日志宏" class="headerlink" title="日志宏"></a>日志宏</h3><h4 id="日志级别辅助宏"><a href="#日志级别辅助宏" class="headerlink" title="日志级别辅助宏"></a>日志级别辅助宏</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LOGD gos::log_stream(LOG_DETAIL)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGI gos::log_stream(LOG_INFO)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGW gos::log_stream(LOG_WARN)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGE gos::log_stream(LOG_ERROR)</span></span><br></pre></td></tr></table></figure>

<h4 id="条件判断日志宏"><a href="#条件判断日志宏" class="headerlink" title="条件判断日志宏"></a>条件判断日志宏</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_IF(condition) ((condition) ? (LOG &lt;&lt; #condition &lt;&lt; <span class="string">&quot;, &quot;</span>) : DoNothing()))</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">LOG_IF</span>(vec.<span class="built_in">size</span>() &gt; <span class="number">100</span>) &lt;&lt; <span class="string">&quot;vec is too large!&quot;</span>;</span><br><span class="line">&lt;=&gt;</span><br><span class="line"><span class="keyword">if</span>(vec.<span class="built_in">size</span>() &gt; <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line">    LOG &lt;&lt; <span class="string">&quot;vec.size() &gt; 100&quot;</span> &lt;&lt; <span class="string">&quot;vec is too large!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样有日志等级区分:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LOGD_IF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGI_IF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGW_IF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOGE_IF</span></span><br></pre></td></tr></table></figure>

<h4 id="特殊日志宏"><a href="#特殊日志宏" class="headerlink" title="特殊日志宏"></a>特殊日志宏</h4><h5 id="LOG-EVERY-N"><a href="#LOG-EVERY-N" class="headerlink" title="LOG_EVERY_N"></a>LOG_EVERY_N</h5><p>每 N 次打印一次日志</p>
<p>用于一些重复打印，如 ATS 报文每秒钟接收，每一条都打印则日志太多，全不打印则无法从日志中查看当前 ATS 报文是否在正常接收</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 每 60 次打印一次</span></span><br><span class="line"><span class="built_in">LOG_EVERY_N</span>(<span class="number">60</span>) &lt;&lt; <span class="string">&quot;Receive ATS Info!&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="LOG-FIRST-N"><a href="#LOG-FIRST-N" class="headerlink" title="LOG_FIRST_N"></a>LOG_FIRST_N</h5><p>前 N 次打印日志</p>
<p>通常用于程序启动时，确认各个线程是否正常启动，打印前 N 条日志。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 打印前五条日志</span></span><br><span class="line"><span class="built_in">LOG_FIRST_N</span>(<span class="number">5</span>) &lt;&lt; <span class="string">&quot;Hello World!&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="LOG-ONCE"><a href="#LOG-ONCE" class="headerlink" title="LOG_ONCE"></a>LOG_ONCE</h5><p>只打印第一次的日志</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">While</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// 该日志只打印一次</span></span><br><span class="line">    LOG_ONCE &lt;&lt; <span class="string">&quot;Thread is start!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符串类与日志类工具函数的演进路线图"><a href="#字符串类与日志类工具函数的演进路线图" class="headerlink" title="字符串类与日志类工具函数的演进路线图"></a>字符串类与日志类工具函数的演进路线图</h3><p>![图片](..&#x2F;resource&#x2F;2021_09_13_C++调试工具函数介绍_李建聪&#x2F;Xmind 1666080438328.png)</p>
<h2 id="时间相关类"><a href="#时间相关类" class="headerlink" title="时间相关类"></a>时间相关类</h2><h3 id="计时器-tick-count"><a href="#计时器-tick-count" class="headerlink" title="计时器 tick_count"></a>计时器 <code>tick_count</code></h3><p>为了更好的记录开始时间和结束时间， 所以封装该对象来记录并获取对应时间间隔的打印。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">tick_count</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">get_time_string</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中 <code>get_time_string()</code> 函数返回 <code>start</code> 到 <code>finish</code> 的间隔时间, 根据时间间隔大小获取的时间单位不同(<code>(s)</code>, <code>(ms)</code>, <code>(us)</code>), 这样打印可以通过搜索 <code>(s)</code> 来快速定位打印了秒级时间的日志。</p>
<h3 id="查看耗时百分比-stop-watch"><a href="#查看耗时百分比-stop-watch" class="headerlink" title="查看耗时百分比 stop_watch"></a>查看耗时百分比 <code>stop_watch</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">stop_watch</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">tick</span><span class="params">(<span class="type">const</span> std::string&amp; strInfo)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/// 在消息容器中，记录信息和时间间隔</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">stop_watch</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        tick.<span class="built_in">finish</span>(<span class="string">&quot;finish&quot;</span>);</span><br><span class="line">        <span class="comment">/// 遍历消息容器，并打印其间隔时间和百分比</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>调用方式:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gos::stop_watch sw;</span><br><span class="line"></span><br><span class="line">    st.<span class="built_in">tick</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">    st.<span class="built_in">tick</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">    st.<span class="built_in">tick</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会出现如下日志:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[2022-10-18 16:45:36.796] time:   5 (us), percent:  0.18% info: 1  &lt;Function: AppRegisterDataManager::OnLoadRegisterInfoRsp, File: AppRegisterDataManager.cpp:17&gt;</span><br><span class="line">[2022-10-18 16:45:36.796] time:   1 (us), percent:  0.04% info: 2  &lt;Function: AppRegisterDataManager::OnLoadRegisterInfoRsp, File: AppRegisterDataManager.cpp:17&gt;</span><br><span class="line">[2022-10-18 16:45:36.796] time:   2 (ms), percent: 99.74% info: 3  &lt;Function: AppRegisterDataManager::OnLoadRegisterInfoRsp, File: AppRegisterDataManager.cpp:17&gt;</span><br><span class="line">[2022-10-18 16:45:36.796] time:   1 (us), percent:  0.04% info: finish  &lt;Function: AppRegisterDataManager::OnLoadRegisterInfoRsp, File: AppRegisterDataManager.cpp:17&gt;</span><br><span class="line">[2022-10-18 16:45:36.796] Total Time: 2ms, info: finish &lt;Function: AppRegisterDataManager::OnLoadRegisterInfoRsp, File: AppRegisterDataManager.cpp:17&gt;</span><br></pre></td></tr></table></figure>

<p>根据百分比找出耗时占比最高的代码片段, 为优化提供思路</p>
<h3 id="记录起止时间-interval-time-factory"><a href="#记录起止时间-interval-time-factory" class="headerlink" title="记录起止时间 interval_time_factory"></a>记录起止时间 <code>interval_time_factory</code></h3><p>为了灵活的获取间隔的时间，把 <code>interval_time</code> 做了一个单例用来全局查看时间间隔。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">interval_time_factory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">(<span class="type">const</span> std::string&amp; strKey)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        m_interval_time.<span class="built_in">insert</span>(gos::<span class="built_in">to_string</span>(p), <span class="built_in">gos_get_uptime_1us</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(<span class="type">const</span> std::string&amp; strKey)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">GosLog</span>(<span class="string">&quot;%s interval time is %d&quot;</span>, strKey.<span class="built_in">c_str</span>(), m_interval_time[strKey]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/// key: 唯一主键, value: 间隔时间记录对象</span></span><br><span class="line">    std::map&lt;std::string, interval_time&gt; m_interval_time;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span>* <span class="title">f1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> *p = <span class="keyword">new</span> <span class="type">int</span>;</span><br><span class="line">    interval_time_factory::<span class="built_in">GetInstance</span>().<span class="built_in">start</span>(gos::<span class="built_in">to_string</span>(p));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(<span class="type">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    interval_time_factory::<span class="built_in">GetInstance</span>().<span class="built_in">finish</span>(gos::<span class="built_in">to_string</span>(p));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">f1</span>();</span><br><span class="line">...</span><br><span class="line"><span class="built_in">f2</span>();</span><br></pre></td></tr></table></figure>

<p>在日志中即可查看该指针从 <code>new</code> 到 <code>delete</code> 所经过的时间。</p>
<p>应用场景举例:</p>
<p>如视频帧从回调函数进入播放队列，到从队列 <code>pop</code> 后渲染完成后执行 <code>delete</code>, 为了记住该视频帧从回调函数到最终渲染的延迟时间。</p>
<h3 id="对象实例个数-object-counter"><a href="#对象实例个数-object-counter" class="headerlink" title="对象实例个数 object_counter"></a>对象实例个数 <code>object_counter</code></h3><p>用与查看某个对象当前存活的实例有几个.</p>
<p>原理为: 在构造函数中计数加一，析构函数中计数减一。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">object</span> : <span class="keyword">public</span> gos::object_counter</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">object obj0;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; obj<span class="number">0.</span><span class="built_in">get_count</span>();  <span class="comment">///&lt; 1</span></span><br><span class="line">&#123;</span><br><span class="line">    object obj1;</span><br><span class="line">    std::cout &lt;&lt; obj<span class="number">1.</span><span class="built_in">get_count</span>();  <span class="comment">///&lt; 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; obj<span class="number">0.</span><span class="built_in">get_count</span>();  <span class="comment">///&lt; 1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="对象存活时间-object-live-time"><a href="#对象存活时间-object-live-time" class="headerlink" title="对象存活时间 object_live_time"></a>对象存活时间 <code>object_live_time</code></h3><p>用于查看某个对象，构造函数到析构函数的时间。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">object</span> : <span class="keyword">public</span> gos::object_live_time</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    object obj;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="comment">/// obj 在此处调用析构函数</span></span><br></pre></td></tr></table></figure>

<p>在日志中可以查看该对象的存活时间</p>
<h2 id="性能调优类"><a href="#性能调优类" class="headerlink" title="性能调优类"></a>性能调优类</h2><h3 id="判断函数执行时间-PROFILER"><a href="#判断函数执行时间-PROFILER" class="headerlink" title="判断函数执行时间 PROFILER"></a>判断函数执行时间 <code>PROFILER</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    INT64 iStart = <span class="built_in">gos_get_uptime_1us</span>();</span><br><span class="line">    ...</span><br><span class="line">    INT64 iFinish = <span class="built_in">gos_get_uptime_1us</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GosLog</span>(LOG_DETAIL, <span class="string">&quot;f is spend time: %lld&quot;</span>, iFinish - iStart);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现原理:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">profiler</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">profiler</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        INT64 iStart = <span class="built_in">gos_get_uptime_1us</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">profiler</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        INT64 iFinish = <span class="built_in">gos_get_uptime_1us</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">GosLog</span>(LOG_DETAIL, <span class="string">&quot;f is spend time: %lld&quot;</span>, iFinish - iStart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    INT64 iStart;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 定义辅助宏</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROFILER() profiler(__FILE__, __FUNCTION__, __LINE__)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>PROFILER()</code> 宏定义了一个临时变量，函数析构则该临时变量析构，所以该宏定义计算的是从该宏定义开始，到该函数结束的时间</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">PROFILER</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但同时应注意, 不能在同一作用域调用两次该宏定义.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">PROFILER</span>();</span><br><span class="line">    <span class="built_in">PROFILER</span>(); <span class="comment">///&lt; 编译错误, 重定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断内存泄漏-MEMORY-CHECK"><a href="#判断内存泄漏-MEMORY-CHECK" class="headerlink" title="判断内存泄漏 MEMORY_CHECK"></a>判断内存泄漏 <code>MEMORY_CHECK</code></h3><p>该宏定义依赖于 <code>Windows</code> 的系统函数。(<code>Linux</code> 和 <code>C++ Builder</code> 中无法使用)</p>
<p>具体实现也是在构造函数中记录当前程序使用的内存数， 析构函数中记录内存差值后打印是否内存泄漏。</p>
<h2 id="业务辅助类"><a href="#业务辅助类" class="headerlink" title="业务辅助类"></a>业务辅助类</h2><h3 id="区间求值函数-clamp"><a href="#区间求值函数-clamp" class="headerlink" title="区间求值函数 clamp"></a>区间求值函数 <code>clamp</code></h3><p>实现功能:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">int</span>&amp; <span class="title">clamp</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; value, <span class="type">const</span> <span class="type">int</span>&amp; low, <span class="type">const</span> <span class="type">int</span>&amp; height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value &lt; low)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/// 数值小于下界， 返回下界值</span></span><br><span class="line">        <span class="keyword">return</span> low;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(height &lt; value)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/// 数值大于上界， 返回上界值</span></span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/// 返回原始值</span></span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用场景:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Conf.<span class="built_in">GetValue</span>(<span class="string">&quot;max_timeout&quot;</span>, iMaxTimeout);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 判断配置项是否配置超出范围</span></span><br><span class="line"><span class="built_in">LOG_IF</span>(iMaxTimeout != gos::<span class="built_in">clamp</span>(iMaxTimeout, <span class="number">0</span>, <span class="number">3600</span>) &lt;&lt; <span class="string">&quot;config is out of range!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 或者自动限制范围</span></span><br><span class="line">iMaxTimeout = gos::<span class="built_in">clamp</span>(iMaxTimeout, <span class="number">0</span>, <span class="number">3600</span>);</span><br></pre></td></tr></table></figure>

<h3 id="心跳业务类-heartbeat"><a href="#心跳业务类-heartbeat" class="headerlink" title="心跳业务类 heartbeat"></a>心跳业务类 <code>heartbeat</code></h3><p>把心跳业务封装成对象，用于其他业务调用.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">heartbeat</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">heartbeat</span>(<span class="type">int</span> max_time_ms);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">live</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">is_live</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 最大超时时间为 3s</span></span><br><span class="line"><span class="function">heartbeat <span class="title">obj</span><span class="params">(<span class="number">3000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// app 心跳消息来了</span></span><br><span class="line">obj.<span class="built_in">live</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/// app 心跳消息来了</span></span><br><span class="line">obj.<span class="built_in">live</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 在定时器中定期轮询</span></span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">timer</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(obj.<span class="built_in">is_live</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="超时业务类-timeout"><a href="#超时业务类-timeout" class="headerlink" title="超时业务类 timeout"></a>超时业务类 <code>timeout</code></h3><p>把超时业务封装成对象，用于其他业务调用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">timeout</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">timeout</span>(<span class="type">int</span> max_time_ms) : <span class="built_in">m_heartbeat</span>(max_time_ms)</span><br><span class="line">    &#123;</span><br><span class="line">        m_heartbeat.<span class="built_in">live</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_timeout</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !m_heartbeat.<span class="built_in">is_live</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    gos::heartbeat m_heartbeat;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 请呼业务呼入时, 定义 60s 超时的对象</span></span><br><span class="line"><span class="function">timeout <span class="title">obj</span><span class="params">(<span class="number">60</span> * <span class="number">1000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 定时器轮询</span></span><br><span class="line"><span class="keyword">if</span>(obj.<span class="built_in">is_timeout</span>())</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模糊比较-approx-与-float-approx"><a href="#模糊比较-approx-与-float-approx" class="headerlink" title="模糊比较 approx 与 float_approx"></a>模糊比较 <code>approx</code> 与 <code>float_approx</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">approx</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">approx</span>(<span class="type">const</span> <span class="type">int64_t</span>&amp; anchor, <span class="type">const</span> <span class="type">int64_t</span>&amp; diff) : <span class="built_in">m_anchor</span>(anchor), <span class="built_in">m_diff</span>(diff) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 判断数值是否与本对象定义的数值相近, 数值在 [m_anchor - m_diff, m_anchor + m_diff] 返回真</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(<span class="type">const</span> <span class="type">int64_t</span>&amp; number)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">abs</span>(number - m_anchor) &lt;= m_diff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int64_t</span> m_anchor;  <span class="comment">///&lt; 用于比较的锚点值</span></span><br><span class="line">    <span class="type">int64_t</span> m_diff;    <span class="comment">///&lt; 浮动的数值</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gos::tick_count timer;</span><br><span class="line">timer.<span class="built_in">start</span>();  <span class="comment">///&lt; 计时开始</span></span><br><span class="line"><span class="built_in">gos_sleep_ms</span>(<span class="number">20</span>);</span><br><span class="line">timer.<span class="built_in">finish</span>(); <span class="comment">///&lt; 计时结束</span></span><br><span class="line"><span class="type">int</span> time = timer.<span class="built_in">get_ms</span>();</span><br><span class="line"><span class="comment">/// 判断时间间隔是否在 20 正负 1 的范围</span></span><br><span class="line"><span class="keyword">if</span>(gos::<span class="built_in">approx</span>(<span class="number">20</span>, <span class="number">1</span>).<span class="built_in">equal</span>(time))</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="互斥量辅助类-lock-guard"><a href="#互斥量辅助类-lock-guard" class="headerlink" title="互斥量辅助类 lock_guard"></a>互斥量辅助类 <code>lock_guard</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">lock_guard</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">lock_guard</span>(gos::mutex&amp; mutex) : <span class="built_in">m_mutex</span>(mutex)</span><br><span class="line">    &#123;</span><br><span class="line">        m_mutex.<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">lock_guard</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        m_mutex.<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    gos::mutex&amp; m_mutex;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>考虑如下情况:</p>
<ol>
<li>多个函数返回</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">gos::mutex mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;gos::mutex&gt; <span class="title">guard</span><span class="params">(mutex)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(condition)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(condition)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(condition)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>返回语句中有被保护数据的读写</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">f2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;gos::mutex&gt; <span class="title">guard</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>抛出异常</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;gos::mutex&gt; <span class="title">guard</span><span class="params">(mutex)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">exception</span>(<span class="string">&quot;抛出异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> d = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(queue.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        queue.<span class="built_in">front</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>多个锁</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gos::mutex mutex1;</span><br><span class="line">gos::mutex mutex2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="function">std::lock_guard&lt;gos::mutex&gt; <span class="title">guard1</span><span class="params">(mutex1)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(condition)</span><br><span class="line">   &#123;</span><br><span class="line">   		<span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function">std::lock_guard&lt;gos::mutex&gt; <span class="title">guard2</span><span class="params">(mutex2)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取更新数据的-GetDifferenceBetweenVector"><a href="#获取更新数据的-GetDifferenceBetweenVector" class="headerlink" title="获取更新数据的 GetDifferenceBetweenVector"></a>获取更新数据的 <code>GetDifferenceBetweenVector</code></h3><p>为了比较新旧数据，增加、删除或更新的元素。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief           获取新旧两个 vector, 需要添加的元素，需要删除的元素，和重复的元素</span></span><br><span class="line"><span class="comment"> * @param           vecOld    [in]  旧数据</span></span><br><span class="line"><span class="comment"> * @param           vecNew    [in]  新数据</span></span><br><span class="line"><span class="comment"> * @param           vecAdd    [out] 需要添加的元素</span></span><br><span class="line"><span class="comment"> * @param           vecDel    [out] 需要删除的元素</span></span><br><span class="line"><span class="comment"> * @param           vecUnion  [out] 需要更新的元素</span></span><br><span class="line"><span class="comment"> * @return          true</span></span><br><span class="line"><span class="comment"> * @return          false</span></span><br><span class="line"><span class="comment"> * @author          lijiancong(lijiancong@gbcom.com.cn)</span></span><br><span class="line"><span class="comment"> * @date            2022-06-02 13:50:34</span></span><br><span class="line"><span class="comment"> * @note</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">GetDifferenceBetweenVector</span><span class="params">(<span class="type">const</span> std::vector&lt;T&gt;&amp; vecOld, <span class="type">const</span> std::vector&lt;T&gt;&amp; vecNew,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       std::vector&lt;T&gt;&amp; vecAdd, std::vector&lt;T&gt;&amp; vecDel, std::vector&lt;T&gt;&amp; vecUnion)</span></span>;</span><br></pre></td></tr></table></figure>

<p>使用场景: ATS 数据更新线路图:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GetDifferenceBetweenVector</span>(vecOldATS, vecNewATS, vecAdd, vecDel, vecUnion);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; vecAdd.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// 创建列车图标</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; vecDel.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// 删除列车图标</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; vecUnion.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// 更新列车图标位置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特殊字符转义函数-EscapeCharUtility"><a href="#特殊字符转义函数-EscapeCharUtility" class="headerlink" title="特殊字符转义函数 EscapeCharUtility"></a>特殊字符转义函数 <code>EscapeCharUtility</code></h3><p>我们已知 GJson 是无法解析带有， <code>&quot;</code>、<code>\&quot;</code>、<code>,&#125;</code>, 但是保存调度台短信历史的时候，短信内容可能包含这些特殊字符。</p>
<p>如 <code>&quot;</code> 转换为 <code>%quotes;</code>、 <code>\</code> 转换为 <code>%backslash;</code></p>
<p>所以采用把特殊字符转换为特定的字符串，再转换成 json 字符串，到服务器后解析出来再替换回来。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 特殊字符转码</span></span><br><span class="line">gos::<span class="built_in">EncodeEscapeChar</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 特殊字符解码</span></span><br><span class="line">gos::<span class="built_in">DecodeEscapeChar</span>();</span><br></pre></td></tr></table></figure>

<h3 id="输入字符串检查对象-input-check"><a href="#输入字符串检查对象-input-check" class="headerlink" title="输入字符串检查对象 input_check"></a>输入字符串检查对象 <code>input_check</code></h3><p>使用场景:</p>
<p>用户输入某个字符串，该字符串需要符合某种规则。</p>
<ul>
<li>所有字符是数字</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">char</span>* sz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!sz)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(sz != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(*sz &lt; <span class="number">0</span> || *sz &gt; <span class="number">9</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>所有字符是 <code>a~z</code>、 <code>A~Z</code> 和 <code>0~9</code></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">char</span>* sz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!sz)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(sz != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isalnum</span>(*sz))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如 <code>MAC</code> 地址中可能会出现 十六进制字符的间隔符号可能为 ‘:’、’-‘ 或者 ‘ ‘</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">char</span>* sz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!sz)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (sz != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*sz != <span class="string">&#x27;:&#x27;</span> &amp;&amp; *sz != <span class="string">&#x27;-&#x27;</span> &amp;&amp; *sz != <span class="string">&#x27; &#x27;</span> &amp;&amp; !(*sz &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; *sz &lt;= <span class="string">&#x27;f&#x27;</span>) &amp;&amp; !(*sz &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; *sz &lt;= <span class="string">&#x27;F&#x27;</span>) &amp;&amp;</span><br><span class="line">            !(*sz &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *sz &lt;= <span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>强密码, 要求字符串中有数字、大小写字母和特殊符号</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">char</span>* sz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!sz)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((遍历一遍，查看是否拥有至少一个数字字符)</span><br><span class="line">        &amp;&amp; (遍历一遍, 查看是否拥有至少一个大写字母)</span><br><span class="line">        &amp;&amp; (遍历一遍, 查看是否拥有至少一个小写字母)</span><br><span class="line">        &amp;&amp; (遍历一遍, 查看是否有至少一个数字字符))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这些函数中，抽象出来了集中规则。</p>
<ul>
<li>字符符合某种规则(如数字、十六进制字符)</li>
<li>字符串中所有字符，全部符合、全部不符合和部分符合规则</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/// 假如每个字符都符合特定规则(字符为数字)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all_of</span>(str, IsNumber);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsNumber</span><span class="params">(<span class="type">const</span> <span class="type">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">bool</span> <span class="params">(*FUNC)</span><span class="params">(<span class="type">const</span> <span class="type">char</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">all_of</span><span class="params">(<span class="type">const</span> std::string&amp; str, FUNC pF)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; str.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> c = str.<span class="built_in">at</span>(i);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">pF</span>(c))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all_of</span>(str, IsNumber);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsUpcaseLetter</span><span class="params">(<span class="type">const</span> <span class="type">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">any_of</span><span class="params">(<span class="type">const</span> std::string&amp; str, FUNC pF)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/// 这个字符串有任一大写字母 且 有任一数字</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">any_of</span>(str, IsUpcaseLetter) &amp;&amp; <span class="built_in">any_of</span>(str, IsNumber);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用法:</p>
<p><code>input_check</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsValid</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gos::input_check filter;</span><br><span class="line">    filter.<span class="built_in">AddRules</span>(any_of, IsNumber).<span class="built_in">AddRules</span>(any_of, IsUpcastLetter);</span><br><span class="line">    <span class="keyword">return</span> filter.<span class="built_in">IsValid</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="json-解析对象接口"><a href="#json-解析对象接口" class="headerlink" title="json 解析对象接口"></a><code>json</code> 解析对象接口</h3><p>定义:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">json_parser</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/// 虚析构函数, 防止内存泄漏</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">json_parser</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 结构体转 Json 字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">StructToJson</span><span class="params">(std::string &amp;str)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Json 字符串转结构体</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">JsonToStruct</span><span class="params">(<span class="type">const</span> std::string &amp;str)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">object</span> : <span class="keyword">public</span> json_parser</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    std::string str;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 结构体转 Json 字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">StructToJson</span><span class="params">(std::string &amp;str)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GJsonParam Param;</span><br><span class="line"></span><br><span class="line">        Param.<span class="built_in">Add</span>(<span class="string">&quot;int&quot;</span>, i);</span><br><span class="line">        Param.<span class="built_in">Add</span>(<span class="string">&quot;string&quot;</span>, str);</span><br><span class="line"></span><br><span class="line">        strJson = Param.<span class="built_in">GetString</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">JsonToStruct</span><span class="params">(<span class="type">const</span> std::string &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GJson Json;</span><br><span class="line">        <span class="keyword">return</span> Json.<span class="built_in">Parse</span>(str) &amp;&amp; Json.<span class="built_in">GetValue</span>(<span class="string">&quot;int&quot;</span>, i) &amp;&amp; Json.<span class="built_in">GetValue</span>(<span class="string">&quot;string&quot;</span>, str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">object obj;</span><br><span class="line"></span><br><span class="line">std::string strJson;</span><br><span class="line"><span class="comment">/// 获取 json 字符串</span></span><br><span class="line">obj.<span class="built_in">StructToJson</span>(strJson);</span><br><span class="line"><span class="comment">/// 发送消息</span></span><br><span class="line"><span class="built_in">SendMsg</span>(strJson);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">json_parser</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/// 结构体转 Json 字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">StructToJson</span><span class="params">(std::string &amp;str)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Json 字符串转结构体</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">JsonToStruct</span><span class="params">(<span class="type">const</span> std::string &amp;str)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 转化结构体数组到 Json 字符串</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">VectorToJson</span><span class="params">(<span class="type">const</span> std::vector&lt;T&gt; &amp;vec, std::string &amp;str)</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 转换 Json 字符串到结构体数组</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">JsonToVector</span><span class="params">(<span class="type">const</span> std::string &amp;strFormatString, std::vector&lt;T&gt; &amp;vec)</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">object</span> : <span class="keyword">public</span> json_parser&lt;object&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">StructToJson</span><span class="params">(std::string &amp;str)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">JsonToStruct</span><span class="params">(<span class="type">const</span> std::string &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::vector&lt;object&gt; vecObj;</span><br><span class="line"></span><br><span class="line">object ObjTemp;</span><br><span class="line">std::string strJson;</span><br><span class="line"><span class="comment">/// 数组 转换 json</span></span><br><span class="line">ObjTemp.<span class="built_in">VectorToJson</span>(vecObj, strJson);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// json 转换 数组</span></span><br><span class="line">ObjTemp.<span class="built_in">JsonToStruct</span>(strJson, vecObj);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="附加介绍-智能指针"><a href="#附加介绍-智能指针" class="headerlink" title="附加介绍: 智能指针"></a>附加介绍: 智能指针</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">shared_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">shared_ptr</span>(T* p) : <span class="built_in">pCount</span>(<span class="keyword">new</span> <span class="type">int</span>), <span class="built_in">p</span>(pData)</span><br><span class="line">    &#123;</span><br><span class="line">        *pCount = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">shared_ptr</span>(<span class="type">const</span> shared_ptr&amp; stOther)</span><br><span class="line">    &#123;</span><br><span class="line">        pCount = stOther.pCount;</span><br><span class="line">        pData = stOther.pData;</span><br><span class="line"></span><br><span class="line">        ++(*pCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">shared_ptr</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        --(*pCount);</span><br><span class="line">        <span class="keyword">if</span>(*pCount == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">delete</span> pCount;</span><br><span class="line">            <span class="keyword">delete</span> pData;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* pCount;</span><br><span class="line">    T* pData;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    shared_ptr obj0; <span class="comment">///&lt; pCount == 1</span></span><br><span class="line">    &#123;</span><br><span class="line">        shared_ptr obj1 = stOther; <span class="comment">///&lt; pCount == 2</span></span><br><span class="line">    &#125; <span class="comment">///&lt; obj1 析构, pCount == 1</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">///&lt;  obj0 析构, pCount 自减为 0, 执行 delete 操作</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/07/21/2022-12-23-C++%20%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E6%B1%A0/" rel="prev" title="C++ 实现高性能内存池">
      <i class="fa fa-chevron-left"></i> C++ 实现高性能内存池
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/07/21/2023-06-27-%E8%BD%AF%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95%E5%92%8C%E6%8A%80%E6%9C%AF/" rel="next" title="软件自动化测试方法和技术">
      软件自动化测试方法和技术 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E7%B1%BB"><span class="nav-number">1.</span> <span class="nav-text">调试日志打印类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%AD%97%E7%AC%A6%E4%B8%B2-to-string"><span class="nav-number">1.1.</span> <span class="nav-text">转换字符串 to_string</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-string-stream-%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.2.</span> <span class="nav-text">使用 string_stream 拼接字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#C-%E6%98%AF%E5%A6%82%E4%BD%95%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84"><span class="nav-number">1.2.1.</span> <span class="nav-text">C 是如何拼接字符串的?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-%E6%98%AF%E5%A6%82%E4%BD%95%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84-1"><span class="nav-number">1.2.2.</span> <span class="nav-text">C++ 是如何拼接字符串的?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-stream-%E6%98%AF%E5%A6%82%E4%BD%95%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84"><span class="nav-number">1.2.3.</span> <span class="nav-text">string_stream 是如何拼接字符串的?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-stream-%E5%AF%B9%E5%85%B6%E4%BB%96%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">1.2.4.</span> <span class="nav-text">string_stream 对其他复杂类型的处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-stream-%E5%A6%82%E4%BD%95%E8%BD%AC%E6%8D%A2%E4%B8%BA-std-string"><span class="nav-number">1.2.5.</span> <span class="nav-text">string_stream 如何转换为 std::string</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-string-stream-%E6%89%93%E5%8D%B0%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">1.2.6.</span> <span class="nav-text">使用 string_stream 打印结构体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-stream-%E4%B8%8E-GosLog-%E7%9A%84%E9%80%82%E9%85%8D"><span class="nav-number">1.2.7.</span> <span class="nav-text">string_stream 与 GosLog 的适配</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#DBG"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">DBG</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DBG-%E7%BB%99%E6%97%A5%E5%BF%97%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%94%B9%E5%8F%98"><span class="nav-number">1.2.7.2.</span> <span class="nav-text">DBG 给日志带来的改变</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%B5%81-log-stream"><span class="nav-number">1.3.</span> <span class="nav-text">日志流 log_stream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97-log-sync"><span class="nav-number">1.4.</span> <span class="nav-text">异步日志 log_sync</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">1.4.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.4.2.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83"><span class="nav-number">1.4.3.</span> <span class="nav-text">性能比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">1.4.4.</span> <span class="nav-text">优缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.4.5.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%AE%8F"><span class="nav-number">1.5.</span> <span class="nav-text">日志宏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%E8%BE%85%E5%8A%A9%E5%AE%8F"><span class="nav-number">1.5.1.</span> <span class="nav-text">日志级别辅助宏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E6%97%A5%E5%BF%97%E5%AE%8F"><span class="nav-number">1.5.2.</span> <span class="nav-text">条件判断日志宏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%97%A5%E5%BF%97%E5%AE%8F"><span class="nav-number">1.5.3.</span> <span class="nav-text">特殊日志宏</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#LOG-EVERY-N"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">LOG_EVERY_N</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LOG-FIRST-N"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">LOG_FIRST_N</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LOG-ONCE"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">LOG_ONCE</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E4%B8%8E%E6%97%A5%E5%BF%97%E7%B1%BB%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E7%9A%84%E6%BC%94%E8%BF%9B%E8%B7%AF%E7%BA%BF%E5%9B%BE"><span class="nav-number">1.6.</span> <span class="nav-text">字符串类与日志类工具函数的演进路线图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E7%B1%BB"><span class="nav-number">2.</span> <span class="nav-text">时间相关类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%97%B6%E5%99%A8-tick-count"><span class="nav-number">2.1.</span> <span class="nav-text">计时器 tick_count</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%80%97%E6%97%B6%E7%99%BE%E5%88%86%E6%AF%94-stop-watch"><span class="nav-number">2.2.</span> <span class="nav-text">查看耗时百分比 stop_watch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E8%B5%B7%E6%AD%A2%E6%97%B6%E9%97%B4-interval-time-factory"><span class="nav-number">2.3.</span> <span class="nav-text">记录起止时间 interval_time_factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E4%B8%AA%E6%95%B0-object-counter"><span class="nav-number">2.4.</span> <span class="nav-text">对象实例个数 object_counter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%98%E6%B4%BB%E6%97%B6%E9%97%B4-object-live-time"><span class="nav-number">2.5.</span> <span class="nav-text">对象存活时间 object_live_time</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E7%B1%BB"><span class="nav-number">3.</span> <span class="nav-text">性能调优类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4-PROFILER"><span class="nav-number">3.1.</span> <span class="nav-text">判断函数执行时间 PROFILER</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F-MEMORY-CHECK"><span class="nav-number">3.2.</span> <span class="nav-text">判断内存泄漏 MEMORY_CHECK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E8%BE%85%E5%8A%A9%E7%B1%BB"><span class="nav-number">4.</span> <span class="nav-text">业务辅助类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%B1%82%E5%80%BC%E5%87%BD%E6%95%B0-clamp"><span class="nav-number">4.1.</span> <span class="nav-text">区间求值函数 clamp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%83%E8%B7%B3%E4%B8%9A%E5%8A%A1%E7%B1%BB-heartbeat"><span class="nav-number">4.2.</span> <span class="nav-text">心跳业务类 heartbeat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E6%97%B6%E4%B8%9A%E5%8A%A1%E7%B1%BB-timeout"><span class="nav-number">4.3.</span> <span class="nav-text">超时业务类 timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A%E6%AF%94%E8%BE%83-approx-%E4%B8%8E-float-approx"><span class="nav-number">4.4.</span> <span class="nav-text">模糊比较 approx 与 float_approx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%92%E6%96%A5%E9%87%8F%E8%BE%85%E5%8A%A9%E7%B1%BB-lock-guard"><span class="nav-number">4.5.</span> <span class="nav-text">互斥量辅助类 lock_guard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E7%9A%84-GetDifferenceBetweenVector"><span class="nav-number">4.6.</span> <span class="nav-text">获取更新数据的 GetDifferenceBetweenVector</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E8%BD%AC%E4%B9%89%E5%87%BD%E6%95%B0-EscapeCharUtility"><span class="nav-number">4.7.</span> <span class="nav-text">特殊字符转义函数 EscapeCharUtility</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1-input-check"><span class="nav-number">4.8.</span> <span class="nav-text">输入字符串检查对象 input_check</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#json-%E8%A7%A3%E6%9E%90%E5%AF%B9%E8%B1%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.9.</span> <span class="nav-text">json 解析对象接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%8A%A0%E4%BB%8B%E7%BB%8D-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="nav-number">5.</span> <span class="nav-text">附加介绍: 智能指针</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jiancong Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiancong Li</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
